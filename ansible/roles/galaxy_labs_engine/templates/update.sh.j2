#!/usr/bin/env bash

# Update Galaxy Labs Engine

set -e

cd {{ project_root }}
git pull

docker compose --profile production run  --remove-orphans --rm labs-engine \
    python manage.py collectstatic --noinput

docker compose --profile production run  --remove-orphans --rm labs-engine \
    python manage.py migrate

# Update file ownership to allow www-data to write logs/media
sudo chown -R www-data:www-data {{ django_root }}/app/app/logs
sudo chown -R www-data:www-data {{ django_root }}/app/app/media

sudo service labs_engine restart

echo ""
echo "~~~ Restarted Galaxy Labs Engine ~~~"
echo ""
